{"version":3,"file":"event-DI7budSv.js","sources":["../src/utils/animate.ts","../src/utils/animation-registry.ts","../src/utils/event.ts"],"sourcesContent":["/**\n * Animates an element using keyframes. Returns a promise that resolves after the animation completes or gets canceled.\n */\nexport function animateTo(el: HTMLElement, keyframes: Keyframe[], options?: KeyframeAnimationOptions) {\n  return new Promise(resolve => {\n    if (options?.duration === Infinity) {\n      throw new Error('Promise-based animations must be finite.');\n    }\n\n    const animation = el.animate(keyframes, {\n      ...options,\n      duration: prefersReducedMotion() ? 0 : options!.duration\n    });\n\n    animation.addEventListener('cancel', resolve, { once: true });\n    animation.addEventListener('finish', resolve, { once: true });\n  });\n}\n\n/** Parses a CSS duration and returns the number of milliseconds. */\nexport function parseDuration(delay: number | string) {\n  delay = delay.toString().toLowerCase();\n\n  if (delay.indexOf('ms') > -1) {\n    return parseFloat(delay);\n  }\n\n  if (delay.indexOf('s') > -1) {\n    return parseFloat(delay) * 1000;\n  }\n\n  return parseFloat(delay);\n}\n\n/** Tells if the user has enabled the \"reduced motion\" setting in their browser or OS. */\nexport function prefersReducedMotion() {\n  const query = window.matchMedia('(prefers-reduced-motion: reduce)');\n  return query.matches;\n}\n\n/**\n * Stops all active animations on the target element. Returns a promise that resolves after all animations are canceled.\n */\nexport function stopAnimations(el: HTMLElement) {\n  return Promise.all(\n    el.getAnimations().map(animation => {\n      return new Promise(resolve => {\n        const handleAnimationEvent = requestAnimationFrame(resolve);\n\n        animation.addEventListener('cancel', () => handleAnimationEvent, { once: true });\n        animation.addEventListener('finish', () => handleAnimationEvent, { once: true });\n        animation.cancel();\n      });\n    })\n  );\n}\n\n/**\n * We can't animate `height: auto`, but we can calculate the height and shim keyframes by replacing it with the\n * element's scrollHeight before the animation.\n */\nexport function shimKeyframesHeightAuto(keyframes: Keyframe[], calculatedHeight: number) {\n  return keyframes.map(keyframe => ({\n    ...keyframe,\n    height: keyframe.height === 'auto' ? `${calculatedHeight}px` : keyframe.height\n  }));\n}\n","export interface ElementAnimation {\n  keyframes: Keyframe[];\n  rtlKeyframes?: Keyframe[];\n  options?: KeyframeAnimationOptions;\n}\n\nexport interface ElementAnimationMap {\n  [animationName: string]: ElementAnimation;\n}\n\nexport interface GetAnimationOptions {\n  /**\n   * The component's directionality. When set to \"rtl\", `rtlKeyframes` will be preferred over `keyframes` where\n   * available using getAnimation().\n   */\n  dir: string;\n}\n\nconst defaultAnimationRegistry = new Map<string, ElementAnimation>();\nconst customAnimationRegistry = new WeakMap<Element, ElementAnimationMap>();\n\nfunction ensureAnimation(animation: ElementAnimation | null) {\n  return animation ?? { keyframes: [], options: { duration: 0 } };\n}\n\n//\n// Given an ElementAnimation, this function returns a new ElementAnimation where the keyframes property reflects either\n// keyframes or rtlKeyframes depending on the specified directionality.\n//\nfunction getLogicalAnimation(animation: ElementAnimation, dir: string) {\n  if (dir.toLowerCase() === 'rtl') {\n    return {\n      keyframes: animation.rtlKeyframes || animation.keyframes,\n      options: animation.options\n    };\n  }\n\n  return animation;\n}\n\n/**\n * Sets a default animation. Components should use the `name.animation` for primary animations and `name.part.animation`\n * for secondary animations, e.g. `dialog.show` and `dialog.overlay.show`. For modifiers, use `drawer.showTop`.\n */\nexport function setDefaultAnimation(animationName: string, animation: ElementAnimation | null) {\n  defaultAnimationRegistry.set(animationName, ensureAnimation(animation));\n}\n\n/** Sets a custom animation for the specified element. */\nexport function setAnimation(el: Element, animationName: string, animation: ElementAnimation | null) {\n  customAnimationRegistry.set(el, { ...customAnimationRegistry.get(el), [animationName]: ensureAnimation(animation) });\n}\n\n/** Gets an element's animation. Falls back to the default if no animation is found. */\nexport function getAnimation(el: Element, animationName: string, options: GetAnimationOptions) {\n  const customAnimation = customAnimationRegistry.get(el);\n\n  // Check for a custom animation\n  if (customAnimation?.[animationName]) {\n    return getLogicalAnimation(customAnimation[animationName], options.dir);\n  }\n\n  // Check for a default animation\n  const defaultAnimation = defaultAnimationRegistry.get(animationName);\n  if (defaultAnimation) {\n    return getLogicalAnimation(defaultAnimation, options.dir);\n  }\n\n  // Fall back to an empty animation\n  return {\n    keyframes: [],\n    options: { duration: 0 }\n  };\n}\n","/** Waits for a specific event to be emitted from an element. Ignores events that bubble up from child elements. */\nexport function waitForEvent(el: HTMLElement, eventName: string) {\n  return new Promise<void>(resolve => {\n    function done(event: Event) {\n      if (event.target === el) {\n        el.removeEventListener(eventName, done);\n        resolve();\n      }\n    }\n\n    el.addEventListener(eventName, done);\n  });\n}\n"],"names":["animateTo","el","keyframes","options","resolve","animation","prefersReducedMotion","stopAnimations","handleAnimationEvent","defaultAnimationRegistry","customAnimationRegistry","ensureAnimation","getLogicalAnimation","dir","setDefaultAnimation","animationName","getAnimation","customAnimation","defaultAnimation","waitForEvent","eventName","done","event"],"mappings":"AAGO,SAASA,EAAUC,EAAiBC,EAAuBC,EAAoC,CACpG,OAAO,IAAI,QAAQC,GAAW,CAC5B,IAAID,GAAA,YAAAA,EAAS,YAAa,IACxB,MAAM,IAAI,MAAM,0CAA0C,EAG5D,MAAME,EAAYJ,EAAG,QAAQC,EAAW,CACtC,GAAGC,EACH,SAAUG,EAAA,EAAyB,EAAIH,EAAS,QAAA,CACjD,EAEDE,EAAU,iBAAiB,SAAUD,EAAS,CAAE,KAAM,GAAM,EAC5DC,EAAU,iBAAiB,SAAUD,EAAS,CAAE,KAAM,GAAM,CAAA,CAC7D,CACH,CAkBO,SAASE,GAAuB,CAErC,OADc,OAAO,WAAW,kCAAkC,EACrD,OACf,CAKO,SAASC,EAAeN,EAAiB,CAC9C,OAAO,QAAQ,IACbA,EAAG,cAAA,EAAgB,IAAII,GACd,IAAI,QAAQD,GAAW,CAC5B,MAAMI,EAAuB,sBAAsBJ,CAAO,EAE1DC,EAAU,iBAAiB,SAAU,IAAMG,EAAsB,CAAE,KAAM,GAAM,EAC/EH,EAAU,iBAAiB,SAAU,IAAMG,EAAsB,CAAE,KAAM,GAAM,EAC/EH,EAAU,OAAA,CAAO,CAClB,CACF,CAAA,CAEL,CCrCA,MAAMI,MAA+B,IAC/BC,MAA8B,QAEpC,SAASC,EAAgBN,EAAoC,CAC3D,OAAOA,GAAa,CAAE,UAAW,CAAA,EAAI,QAAS,CAAE,SAAU,EAAE,CAC9D,CAMA,SAASO,EAAoBP,EAA6BQ,EAAa,CACrE,OAAIA,EAAI,YAAA,IAAkB,MACjB,CACL,UAAWR,EAAU,cAAgBA,EAAU,UAC/C,QAASA,EAAU,OAAA,EAIhBA,CACT,CAMO,SAASS,EAAoBC,EAAuBV,EAAoC,CAC7FI,EAAyB,IAAIM,EAAeJ,EAAgBN,CAAS,CAAC,CACxE,CAQO,SAASW,EAAaf,EAAac,EAAuBZ,EAA8B,CAC7F,MAAMc,EAAkBP,EAAwB,IAAIT,CAAE,EAGtD,GAAIgB,GAAA,MAAAA,EAAkBF,GACpB,OAAOH,EAAoBK,EAAgBF,CAAa,EAAGZ,EAAQ,GAAG,EAIxE,MAAMe,EAAmBT,EAAyB,IAAIM,CAAa,EACnE,OAAIG,EACKN,EAAoBM,EAAkBf,EAAQ,GAAG,EAInD,CACL,UAAW,CAAA,EACX,QAAS,CAAE,SAAU,CAAA,CAAE,CAE3B,CCxEO,SAASgB,EAAalB,EAAiBmB,EAAmB,CAC/D,OAAO,IAAI,QAAchB,GAAW,CAClC,SAASiB,EAAKC,EAAc,CACtBA,EAAM,SAAWrB,IACnBA,EAAG,oBAAoBmB,EAAWC,CAAI,EACtCjB,EAAA,EACF,CAGFH,EAAG,iBAAiBmB,EAAWC,CAAI,CAAA,CACpC,CACH"}