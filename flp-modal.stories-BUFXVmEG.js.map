{"version":3,"file":"flp-modal.stories-BUFXVmEG.js","sources":["../src/components/flp-modal/flp-modal.styles.ts","../src/components/flp-modal/flp-modal.ts"],"sourcesContent":["import { css } from 'lit';\nimport componentStyles from '../../styles/component.styles';\n\nexport const flippico = css`\n${componentStyles}\n\n:host {\n  --width: 31rem;\n  --header-spacing: var(--flp-spacing-large);\n  --body-spacing: var(--flp-spacing-large);\n  --footer-spacing: var(--flp-spacing-large);\n\n  display: contents;\n}\n\n.dialog {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: var(--flp-z-index-dialog);\n}\n\n.dialog__panel {\n  display: flex;\n  flex-direction: column;\n  z-index: 2;\n  width: var(--width);\n  max-width: calc(100% - var(--flp-spacing-2x-large));\n  max-height: calc(100% - var(--flp-spacing-2x-large));\n  background-color: var(--flp-panel-background-color);\n  border-radius: var(--flp-border-radius-medium);\n  box-shadow: var(--flp-shadow-x-large);\n}\n\n.dialog__panel:focus {\n  outline: none;\n}\n\n/* Ensure there's enough vertical padding for phones that don't update vh when chrome appears (e.g. iPhone) */\n@media screen and (max-width: 420px) {\n  .dialog__panel {\n    max-height: 80vh;\n  }\n}\n\n.dialog--open .dialog__panel {\n  display: flex;\n  opacity: 1;\n}\n\n.dialog__header {\n  flex: 0 0 auto;\n  display: flex;\n}\n\n.dialog__title {\n  flex: 1 1 auto;\n  font: inherit;\n  font-size: var(--flp-font-size-large);\n  line-height: var(--flp-line-height-dense);\n  padding: var(--header-spacing);\n  margin: 0;\n}\n\n.dialog__header-actions {\n  flex-shrink: 0;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: end;\n  gap: var(--flp-spacing-2x-small);\n  padding: 0 var(--header-spacing);\n}\n\n.dialog__header-actions sl-icon-button,\n.dialog__header-actions ::slotted(sl-icon-button) {\n  flex: 0 0 auto;\n  display: flex;\n  align-items: center;\n  font-size: var(--flp-font-size-medium);\n}\n\n.dialog__body {\n  flex: 1 1 auto;\n  display: block;\n  padding: var(--body-spacing);\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n}\n\n.dialog__footer {\n  flex: 0 0 auto;\n  text-align: right;\n  padding: var(--footer-spacing);\n}\n\n.dialog__footer ::slotted(sl-button:not(:first-of-type)) {\n  margin-inline-start: var(--flp-spacing-x-small);\n}\n\n.dialog:not(.dialog--has-footer) .dialog__footer {\n  display: none;\n}\n\n.dialog__overlay {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background-color: var(--flp-overlay-background-color);\n}\n\n@media (forced-colors: active) {\n  .dialog__panel {\n    border: solid 1px var(--flp-color-neutral-0);\n  }\n}\n`;","import { CSSResultGroup, html } from 'lit';\nimport FlpElement from '../../utils/flippico-element';\nimport {customElement, property, query} from 'lit/decorators.js';\n\nimport { flippico } from './flp-modal.styles';\nimport { HasSlotController } from '../../utils/slot';\nimport ModalRaw from '../../utils/modal-raw';\nimport { lockBodyScrolling, unlockBodyScrolling } from '../../utils/scroll';\nimport { getAnimation } from '../../utils/animation-registry';\nimport { animateTo, stopAnimations } from '../../utils/animate';\nimport { waitForEvent } from '../../utils/event';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { watch } from '../../utils/watch';\n\n/**\n * @summary This the flp-modal component\n *\n * @tag flp-modal\n */\n @customElement(\"flp-modal\")\nexport class FlpModal extends FlpElement {\n  static styles: CSSResultGroup = [flippico];\n\n  private readonly hasSlotController = new HasSlotController(this, 'footer');\n  private originalTrigger: HTMLElement | null;\n  public modal = new ModalRaw(this);\n\n  @query('.dialog') dialog: HTMLElement;\n  @query('.dialog__panel') panel: HTMLElement;\n  @query('.dialog__overlay') overlay: HTMLElement;\n\n  /**\n   * Indicates whether or not the dialog is open. You can toggle this attribute to show and hide the dialog, or you can\n   * use the `show()` and `hide()` methods and this attribute will reflect the dialog's open state.\n   */\n  @property({ type: Boolean, reflect: true }) open = false;\n\n  /**\n   * The dialog's label as displayed in the header. You should always include a relevant label even when using\n   * `no-header`, as it is required for proper accessibility. If you need to display HTML, use the `label` slot instead.\n   */\n  @property({ reflect: true }) label = '';\n\n  /**\n   * Disables the header. This will also remove the default close button, so please ensure you provide an easy,\n   * accessible way for users to dismiss the dialog.\n   */\n  @property({ attribute: 'no-header', type: Boolean, reflect: true }) noHeader = false;\n\n  firstUpdated() {\n    this.dialog.hidden = !this.open;\n\n    if (this.open) {\n      this.addOpenListeners();\n      this.modal.activate();\n      lockBodyScrolling(this);\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.modal.deactivate();\n    unlockBodyScrolling(this);\n  }\n\n  private requestClose(source: 'close-button' | 'keyboard' | 'overlay') {\n    const flpRequestClose = this.emit('flp-request-close', {\n      cancelable: true,\n      detail: { source }\n    });\n\n    if (flpRequestClose.defaultPrevented) {\n      const animation = getAnimation(this, 'dialog.denyClose', { dir: 'ltr' });\n      animateTo(this.panel, animation.keyframes, animation.options);\n      return;\n    }\n\n    this.hide();\n  }\n\n  private addOpenListeners() {\n    document.addEventListener('keydown', this.handleDocumentKeyDown);\n  }\n\n  private removeOpenListeners() {\n    document.removeEventListener('keydown', this.handleDocumentKeyDown);\n  }\n\n  private handleDocumentKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Escape' && this.modal.isActive() && this.open) {\n      event.stopPropagation();\n      this.requestClose('keyboard');\n    }\n  };\n\n  @watch('open', { waitUntilFirstUpdate: true })\n  async handleOpenChange() {\n    if (this.open) {\n      // Show\n      this.emit('flp-show');\n      this.addOpenListeners();\n      this.originalTrigger = document.activeElement as HTMLElement;\n      this.modal.activate();\n\n      lockBodyScrolling(this);\n\n      // When the dialog is shown, Safari will attempt to set focus on whatever element has autofocus. This can cause\n      // the dialogs's animation to jitter (if it starts offscreen), so we'll temporarily remove the attribute, call\n      // `focus({ preventScroll: true })` ourselves, and add the attribute back afterwards.\n      //\n      // Related: https://github.com/shoelace-style/shoelace/issues/693\n      //\n      const autoFocusTarget = this.querySelector('[autofocus]');\n      if (autoFocusTarget) {\n        autoFocusTarget.removeAttribute('autofocus');\n      }\n\n      await Promise.all([stopAnimations(this.dialog), stopAnimations(this.overlay)]);\n      this.dialog.hidden = false;\n\n      // Set initial focus\n      requestAnimationFrame(() => {\n        const flpInitialFocus = this.emit('flp-initial-focus', { cancelable: true });\n\n        if (!flpInitialFocus.defaultPrevented) {\n          // Set focus to the autofocus target and restore the attribute\n          if (autoFocusTarget) {\n            (autoFocusTarget as HTMLInputElement).focus({ preventScroll: true });\n          } else {\n            this.panel.focus({ preventScroll: true });\n          }\n        }\n\n        // Restore the autofocus attribute\n        if (autoFocusTarget) {\n          autoFocusTarget.setAttribute('autofocus', '');\n        }\n      });\n\n      const panelAnimation = getAnimation(this, 'dialog.show', { dir: 'ltr' });\n      const overlayAnimation = getAnimation(this, 'dialog.overlay.show', { dir: 'ltr' });\n      await Promise.all([\n        animateTo(this.panel, panelAnimation.keyframes, panelAnimation.options),\n        animateTo(this.overlay, overlayAnimation.keyframes, overlayAnimation.options)\n      ]);\n\n      this.emit('flp-after-show');\n    } else {\n      // Hide\n      this.emit('flp-hide');\n      this.removeOpenListeners();\n      this.modal.deactivate();\n\n      await Promise.all([stopAnimations(this.dialog), stopAnimations(this.overlay)]);\n      const panelAnimation = getAnimation(this, 'dialog.hide', { dir: 'ltr' });\n      const overlayAnimation = getAnimation(this, 'dialog.overlay.hide', { dir: 'ltr' });\n\n      // Animate the overlay and the panel at the same time. Because animation durations might be different, we need to\n      // hide each one individually when the animation finishes, otherwise the first one that finishes will reappear\n      // unexpectedly. We'll unhide them after all animations have completed.\n      await Promise.all([\n        animateTo(this.overlay, overlayAnimation.keyframes, overlayAnimation.options).then(() => {\n          this.overlay.hidden = true;\n        }),\n        animateTo(this.panel, panelAnimation.keyframes, panelAnimation.options).then(() => {\n          this.panel.hidden = true;\n        })\n      ]);\n\n      this.dialog.hidden = true;\n\n      // Now that the dialog is hidden, restore the overlay and panel for next time\n      this.overlay.hidden = false;\n      this.panel.hidden = false;\n\n      unlockBodyScrolling(this);\n\n      // Restore focus to the original trigger\n      const trigger = this.originalTrigger;\n      if (typeof trigger?.focus === 'function') {\n        setTimeout(() => trigger.focus());\n      }\n\n      this.emit('flp-after-hide');\n    }\n  }\n\n  /** Shows the dialog. */\n  async show() {\n    if (this.open) {\n      return undefined;\n    }\n\n    this.open = true;\n    return waitForEvent(this, 'flp-after-show');\n  }\n\n  /** Hides the dialog */\n  async hide() {\n    if (!this.open) {\n      return undefined;\n    }\n\n    this.open = false;\n    return waitForEvent(this, 'flp-after-hide');\n  }\n\n  render() {\n    return html`\n      <div\n        part=\"base\"\n        class=${classMap({\n          dialog: true,\n          'dialog--open': this.open,\n          'dialog--has-footer': this.hasSlotController.test('footer')\n        })}\n      >\n        <div part=\"overlay\" class=\"dialog__overlay\" @click=${() => this.requestClose('overlay')} tabindex=\"-1\"></div>\n\n        <div\n          part=\"panel\"\n          class=\"dialog__panel\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-hidden=${this.open ? 'false' : 'true'}\n          aria-label=${ifDefined(this.noHeader ? this.label : undefined)}\n          aria-labelledby=${ifDefined(!this.noHeader ? 'title' : undefined)}\n          tabindex=\"-1\"\n        >\n          ${!this.noHeader\n            ? html`\n                <header part=\"header\" class=\"dialog__header\">\n                  <h2 part=\"title\" class=\"dialog__title\" id=\"title\">\n                    <slot name=\"label\"> ${this.label.length > 0 ? this.label : String.fromCharCode(65279)} </slot>\n                  </h2>\n                  <div part=\"header-actions\" class=\"dialog__header-actions\">\n                    <slot name=\"header-actions\"></slot>\n                    <flp-icon-button\n                      part=\"close-button\"\n                      exportparts=\"base:close-button__base\"\n                      class=\"dialog__close\"\n                      name=\"x-lg\"\n                      label=\"close\"\n                      library=\"system\"\n                      @click=\"${() => this.requestClose('close-button')}\"\n                    ></flp-icon-button>\n                  </div>\n                </header>\n              `\n            : ''}\n          ${\n            '' /* The tabindex=\"-1\" is here because the body is technically scrollable if overflowing. However, if there's no focusable elements inside, you won't actually be able to scroll it via keyboard. Previously this was just a <slot>, but tabindex=\"-1\" on the slot causes children to not be focusable. https://github.com/shoelace-style/shoelace/issues/1753#issuecomment-1836803277 */\n          }\n          <div part=\"body\" class=\"dialog__body\" tabindex=\"-1\"><slot></slot></div>\n\n          <footer part=\"footer\" class=\"dialog__footer\">\n            <slot name=\"footer\"></slot>\n          </footer>\n        </div>\n      </div>\n    `;\n  }\n}\n"],"names":["flippico","css","componentStyles","FlpModal","FlpElement","HasSlotController","ModalRaw","event","lockBodyScrolling","unlockBodyScrolling","source","animation","getAnimation","animateTo","autoFocusTarget","stopAnimations","panelAnimation","overlayAnimation","trigger","waitForEvent","html","classMap","ifDefined","__decorateClass","query","property","watch","customElement"],"mappings":"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"}