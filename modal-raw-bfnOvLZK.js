import{g as l}from"./tabbable-BIdkFw3w.js";function*d(s=document.activeElement){s!=null&&(yield s,"shadowRoot"in s&&s.shadowRoot&&s.shadowRoot.mode!=="closed"&&(yield*d(s.shadowRoot.activeElement)))}function f(){return[...d()].pop()}let o=[];class p{constructor(t){this.tabDirection="forward",this.handleFocusIn=()=>{this.isActive()&&this.checkFocus()},this.handleKeyDown=n=>{var h,u;if(n.key!=="Tab"||this.isExternalActivated||!this.isActive())return;const r=f();if(this.previousFocus=r,this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;n.shiftKey?this.tabDirection="backward":this.tabDirection="forward";const e=l(this.element);let i=e.findIndex(b=>b===r);if(this.previousFocus=this.currentFocus,i===-1){if(this.currentFocus=e[0],this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;n.preventDefault(),(h=this.currentFocus)==null||h.focus({preventScroll:!1});return}const c=this.tabDirection==="forward"?1:-1;i+c>=e.length?i=0:i+c<0?i=e.length-1:i+=c,this.previousFocus=this.currentFocus;const a=e[i];this.tabDirection==="backward"&&this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus)||a&&this.possiblyHasTabbableChildren(a)||(n.preventDefault(),this.currentFocus=a,(u=this.currentFocus)==null||u.focus({preventScroll:!0}),setTimeout(()=>this.checkFocus()))},this.handleKeyUp=()=>{this.tabDirection="forward"},this.element=t,this.elementsWithTabbableControls=["iframe"]}activate(){o.push(this.element),document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}deactivate(){o=o.filter(t=>t!==this.element),this.currentFocus=null,document.removeEventListener("focusin",this.handleFocusIn),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}isActive(){return o[o.length-1]===this.element}activateExternal(){this.isExternalActivated=!0}deactivateExternal(){this.isExternalActivated=!1}checkFocus(){if(this.isActive()&&!this.isExternalActivated){const t=l(this.element);if(!this.element.matches(":focus-within")){const n=t[0],r=t[t.length-1],e=this.tabDirection==="forward"?n:r;typeof(e==null?void 0:e.focus)=="function"&&(this.currentFocus=e,e.focus({preventScroll:!1}))}}}possiblyHasTabbableChildren(t){return this.elementsWithTabbableControls.includes(t.tagName.toLowerCase())||t.hasAttribute("controls")}}export{p as M};
//# sourceMappingURL=modal-raw-bfnOvLZK.js.map
